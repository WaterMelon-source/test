<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop</title>
    <link rel="stylesheet" href="styles.css">
    <link href='https://fonts.googleapis.com/css?family=Noto+Sans' rel='stylesheet'>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body onload="myFunction()">
    <div id="loader"></div>
    <main style="display:none;" id="myDiv" class="animate-bottom menu">
        <div class="item">
            <img src="1_magic_ball.png" alt="">
            <div class="details">
                <p>1 ðŸ”® â€¢ <span class="price">69 â‚½</span></p>
                <button onclick="buy()" class="add-btn">ÐšÐ£ÐŸÐ˜Ð¢Ð¬</button>
            </div>
        </div>
        <div class="item">
            <img src="3_magic_balls.png" alt="">
            <div class="details">
                <p>3 ðŸ”® â€¢ <span class="price">169 â‚½</span></p>
                <button onclick="animateRipple(event)" class="add-btn">ÐšÐ£ÐŸÐ˜Ð¢Ð¬</button>
            </div>
        </div>
        <div class="item">
            <img src="5_magic_balls.png" alt="">
            <div class="details">
                <p>5 ðŸ”® â€¢ <span class="price">269 â‚½</span></p>
                <button onclick="animateRipple(event)" class="add-btn">ÐšÐ£ÐŸÐ˜Ð¢Ð¬</button>
            </div>
        </div>
        <div class="item">
            <img src="10_magic_balls.png" alt="">
            <div class="details">
                <p>10 ðŸ”® â€¢ <span class="price">469 â‚½</span></p>
                <button onclick="animateRipple(event)" class="add-btn">ÐšÐ£ÐŸÐ˜Ð¢Ð¬</button>
            </div>
        </div>
        <div class="item">
            <img src="25_magic_balls.png" alt="">
            <div class="details">
                <p>25 ðŸ”® â€¢ <span class="price">869 â‚½</span></p>
                <button onclick="animateRipple(event)" class="add-btn">ÐšÐ£ÐŸÐ˜Ð¢Ð¬</button>
            </div>
        </div>
        <div class="item">
            <img src="50_magic_balls.png" alt="">
            <div class="details">
                <p>50 ðŸ”® â€¢ <span class="price">1669 â‚½</span></p>
                <button onclick="animateRipple(event)" class="add-btn">ÐšÐ£ÐŸÐ˜Ð¢Ð¬</button>
            </div>
        </div>
    </main>
    <script>
        const tg = window.Telegram.WebApp;

        var myVar;

        function myFunction() {
            myVar = setTimeout(showPage, 3000);
        }

        function showPage() {
            document.getElementById("loader").style.display = "none";
            document.getElementById("myDiv").style.display = "flex";
        }
        
        function buy() {
            const tg = window.Telegram.WebApp;
            const url = 'http://127.0.0.1:5000/handle_endpoint'; // Replace with your backend endpoint
            
            document.getElementById('paymentButton').addEventListener('click', function() {
                const data = JSON.stringify({
                    // Replace with data structure your backend expects
                    amount: 100,  // Example data
                    currency: 'USD'  // Example data
                });

                tg.MainButton.show();
                tg.MainButton.setText("Pay");
                tg.MainButton.onClick(() => {
                    console.log("Starting payment process...");
                    const xhr = new XMLHttpRequest();
                    xhr.open("POST", url, true);
                    xhr.setRequestHeader("Content-Type", "application/json");
                    xhr.setRequestHeader("X-Custom-Info", "getOpenInvoiceUrl");
                    xhr.onreadystatechange = function () {
                        if (xhr.readyState === 4 && xhr.status === 200) {
                            const response = JSON.parse(xhr.responseText);
                            const invoiceUrl = response.invoice_url;
                            if (invoiceUrl) {
                                // Open invoice URL in a new tab
                                window.open(invoiceUrl, '_blank');
                            } else {
                                console.error('Failed to get invoice URL');
                            }
                        }
                    };
                    xhr.send(data);
            });
        });
        }

        function animateRipple(event) {
            const button = event.currentTarget;
            
            // Remove existing ripples
            const ripples = button.querySelectorAll('.ripple');
            ripples.forEach(ripple => ripple.remove());
            
            // Create new ripple element
            const ripple = document.createElement('span');
            ripple.classList.add('ripple');
            
            // Calculate position of click relative to the button
            const rect = button.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const y = event.clientY - rect.top;
            
            // Set ripple position and activate animation
            ripple.style.left = `${x}px`;
            ripple.style.top = `${y}px`;
            button.appendChild(ripple);
            
            // Remove ripple after animation ends
            ripple.addEventListener('animationend', () => {
                ripple.remove();
            });
        }
    </script>
</body>
</html>
